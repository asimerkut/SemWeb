<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:o="http://omnifaces.org/ui"
	xmlns:of="http://omnifaces.org/functions"
	template="/WEB-INF/content/template/simple.xhtml"
	xmlns:abc="http://www.abacus.com/abc">

	<ui:define name="content">

		<o:importConstants
			type="org.abacus.definition.shared.constant.EnumList.CatMenuPeriod" />

		<p:panel header="Menu">

			<h:form>
				<h:panelGrid columns="3">
					<p:outputLabel for="menuTimeCal" value="Zaman:"
						style="font-weigh: bold" />
					<p:calendar id="menuTimeCal"
						value="#{catMenuViewBean.searchCriteria.date}">
						<p:ajax event="dateSelect"
							listener="#{catMenuViewBean.menuDateSelected}"
							update=":menuDetailForm" />
					</p:calendar>

					<p:selectOneButton value="#{catMenuViewBean.searchCriteria.period}"
						style="width:145px">
						<f:selectItems value="#{CatMenuPeriod}" var="menuEnum"
							itemLabel="#{menuEnum.description}" itemValue="#{menuEnum}" />
						<p:ajax event="change"
							listener="#{catMenuViewBean.menuDateSelected}"
							update=":menuDetailForm" />
					</p:selectOneButton>
				</h:panelGrid>
			</h:form>

			<h:form id="menuDetailForm">
				<p:panelGrid style="width:100%">

					<f:facet name="header">
						<p:row>
							<p:column
								colspan="#{catMenuViewBean.menuSummary.meals.size() + 2}"
								style="font-weight:bold">HaftalÄ±k Yemek Listesi</p:column>
						</p:row>
						<p:row>
							<p:column style="font-weight:bold">Gun</p:column>
							<c:forEach var="mealFilter"
								items="#{catMenuViewBean.menuSummary.meals}">
								<p:column style="font-weight:bold">#{mealFilter.meal.name}</p:column>
							</c:forEach>
							<p:column style="font-weight:bold;">Gun Sonu Ozet</p:column>
						</p:row>
					</f:facet>

					<c:forEach var="dailyMenu"
						items="#{catMenuViewBean.menuSummary.dailyMenuDetails}">
						<p:row>

							<p:column
								style="font-weight:bold;width:4%;background-color:#F7F7F7">
								<h:outputText value="#{dailyMenu.date}">
									<f:convertDateTime timeZone="Turkey" pattern="dd/MM/yyyy (E)"
										locale="tr_TR" />
								</h:outputText>
							</p:column>

							<c:forEach var="mealFilter"
								items="#{catMenuViewBean.menuSummary.meals}">

								<c:set value="#{dailyMenu.menuMap.get(mealFilter.meal.code)}"
									var="menuEntitys" />



								<p:column style="font-weight:bold;width:4%"> Mercimek (Az Tuzlu)<br></br>Lahana (Taze gelenler)<br></br> Limonata (Sulandirilmis) <br></br>Salata (Havuc, Patetes)<br></br>
									<ui:repeat var="menuItem" value="#{menuEntity.menuItemSet}">
									#{menuItem.name}
									</ui:repeat>
								</p:column>


							</c:forEach>
							<p:column rowspan="2"
								style="width:4%;font-weight:bold;background-color:#E6EBFA">250TL</p:column>

						</p:row>

						<p:row styleClass="ui-widget-header">
							<p:column colspan="1"
								style="font-weight:bold;background-color:#FFE6E6">Menu Ozeti</p:column>
							<c:forEach var="mealFilter"
								items="#{catMenuViewBean.menuSummary.meals}">
								<p:column colspan="1"
									style="font-weight:bold;background-color:#FFE6E6">
									<c:set value="#{dailyMenu.menuMap.get(mealFilter.meal.code)}"
										var="menuEntity" />
									<c:set
										value="#{catMenuViewBean.isMealActiveAtGivenDate(mealFilter,dailyMenu.date)}"
										var="isMealActive" />

									<p:commandButton icon="ui-icon-search"
										rendered="#{isMealActive and empty menuEntity}"
										update=":menuDialogFrm" oncomplete="PF('menuDialog').show()">
										<p:ajax event="click"
											listener="#{catMenuViewBean.initCreateMenu(mealFilter,dailyMenu)}" />
									</p:commandButton>
									<p:commandButton icon="ui-icon-check" />
									<p:commandButton icon="ui-icon-close" />
								</p:column>
							</c:forEach>

						</p:row>


					</c:forEach>

				</p:panelGrid>

			</h:form>
		</p:panel>

		<h:form id="menuDialogFrm">
			<p:dialog widgetVar="menuDialog" resizable="true" showEffect="fade"
				modal="true" appendToBody="@(body)" height="60%" width="600px">

				<f:facet name="header">
					<p:outputLabel value="Menu" />
				</f:facet>

				<p:dataTable id="menuItems" var="menuItem"
					value="#{catMenuViewBean.selectedMenu.menuItemSet}"
					emptyMessage="Secili malzeme bulunmamaktadir">
					<f:facet name="header">
					Yemek Listesi
				</f:facet>

					<p:column headerText="Yemek">
						<h:outputLabel
							value="#{menuItem.item.name} - (#{menuItem.item.code})"></h:outputLabel>
					</p:column>
					<p:column headerText="Islem">
						<p:commandButton icon="ui-icon-close"
							action="#{catMenuViewBean.removeMenuItemFromMenu(menuItem)}"
							update=":menuDialogFrm:menuItems" />
					</p:column>

				</p:dataTable>

				<p:spacer width="5px" />

				<h:panelGrid columns="5">
					<abc:itemSelection id="itemSelectionInput"
						widgetVar="itemSelectionWdg"
						value="#{catMenuViewBean.selectedItem}" />
					<p:commandButton value="ekle"
						actionListener="#{catMenuViewBean.addItemToMenu}"
						update=":menuDialogFrm:menuItems" process="@form" />
				</h:panelGrid>



				<f:facet name="footer">
					<p:commandButton value="Kaydet" />
					<p:spacer width="5px" />
					<p:commandButton value="Vazgec"
						oncomplete="PF('menuDialog').hide();" immediate="true" />
				</f:facet>

			</p:dialog>
		</h:form>

	</ui:define>

	<ui:define name="model">
		<o:importConstants
			type="org.abacus.definition.shared.constant.EnumList.DefItemClassEnum" />
		<o:importConstants
			type="org.abacus.definition.shared.constant.EnumList.DefTypeEnum" />
		<abc:itemSelectionDialog id="itemSelectionDialog"
			update=":menuDialogFrm:itemSelectionInput"
			itemClass="#{DefItemClassEnum.STK_P}" widgetVar="itemSelectionWdg"
			itemType="#{DefTypeEnum.ITM_SR_ST}"
			value="#{catMenuViewBean.selectedItem}" />
	</ui:define>

</ui:composition>
